# FlyWheel计划与安排

### 现有问题：
1. bug的发现/性能问题/耗电量/流量等问题，完全依赖于QA测试与用户反馈，无论是排查难度还是发现率都很低。
2. 某些问题排查依赖于log版/灰度版，同时代码中需要增加若干日志或者埋点，对代码侵入大，排查耗时长。

### 工作内容：
1. 设计一种无侵入或低侵入的辅助开发框架，帮助开发者提前发现问题，并定位问题。框架需要模块化，支持可选的模块增减。

合作完成如下模块设计与开发：

2. 提供内存泄露检测模块
3. 提供ANR与卡顿检测模块
4. 提供耗电量检测模块
5. 提供流量检测模块
6. 提供Crash分析模块
7. 提供更细时间粒度性能分析模块
8. etc.

### 期望收益：
1. 基于该框架能够发现更多bug或问题
2. 基于该框架能够解决更多bug或问题

### 收益评估方式：
1. 基于该框架发现的bug或问题数量
2. 基于该框架解决的bug或问题数量

### 工作计划

Q1：

1. 框架完善，接入输入法
2. 内存泄露模块

Q2：

1. ANR与卡顿模块
2. 细粒度性能分析模块

Q3：

1. 耗电量模块
2. 流量模块
3. Crash模块

### 附：工作细分

#### 框架完善 & 输入法接入
- 上传接口
- 模块化能力

#### 内存泄露模块（无侵入）
- 基于LeakCanary
- 需要完善输入法面板部分的生命周期/浮层部分的生命周期，在此基础上，修改LeakCanary关于生命周期监听的实现，增加对输入法面板生命周期的支持
- 配合本地内存分析工具

#### ANR与卡顿模块（无侵入）
- 检测长时间的卡顿或ANR问题并上报
- 测试与完善

#### 细粒度性能分析模块（低侵入）
- 可以分析关键函数的执行时间，对于超出预期时间的执行进行上报，并且可以还原场景
- 基于AOP技术（btw. 似乎夏队长已经实现了类似的）

#### 耗电量模块（无侵入）
- 支持android5.0以上，获取耗电量详情统计
- 客户端支持简单的分析，如果客户端发生异常耗电情况，执行上报
- 配合本地Battery Historian

#### 流量模块（无侵入）
- 统计客户端流量行为
- 分析上报异常流量
- 可以增加对网络状态的分析，比如网络异常请求

#### Crash模块（无侵入）
- 整合目前的CLOG, KLOG等
- 支持Crash恢复（连续多次发生同一个crash时，客户端需要有能力从该crash中恢复，以保证用户正常使用）

#### 其它
- 整合Tinker
- 整合用户反馈
- 整合升级模块
- etc.
