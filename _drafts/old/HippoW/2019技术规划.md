# 技术规划

## 1. 组件化

### 1.1. 业务层面

#### 1.1.1. 组件化核心框架Coco完善：

1. 强化路由能力：完善url解析，支持activity路由，改成annotation方式 *@王辰*
2. 强化通信能力：使用RxJava替代目前写法 *@陈朱伟*
3. 重写ServiceLoader：解决class缓存，路径等问题 *@陈朱伟*

#### 1.1.2. 输入法架构重构：

现有基础上继续调整`ime - imebase - imecommon`代码，工程全面组件化

1. ime组件划分方案确认：在`input-core-panel-other`的组件方案上进行完善，已确认
2. imebase完善调整：imebase的定位为提供输入法的基础开发模式框架与各种自定义View。
3. imecommon完善调整：imecommon的定位为提供Android开发通用的工具、功能。*@王辰*，*@陈朱伟*


#### 1.1.3. 业务组件拆分：

根据业务情况对业务组件进行拆分

1. Emotion独立工程，主线接入Emotion
2. Voice拆分
3. Input拆分

### 1.2. 流程层面

1. 脚手架与自动构建：联合QA继续完善自动构建与发布，继续完善脚手架工程
2. 开发流程规范：强化文档要求，强化lint检查，单测覆盖，引入构建时检查
3. 版本管理平台：开发组件AAR版本更新管理平台，解决组件版本号间冲突问题

## 2. 性能监控

### 2.1. 崩溃监控完善

1. Native崩溃收集强化：重写native崩溃收集机制
2. 崩溃上传机制完善：提高崩溃上传率，完善触发、重传逻辑

### 2.2. 链路埋点

#### 2.2.1. 全链路事件自动埋点：
	
1. 事件分类：用户事件、网络事件、I/O事件、内核事件、etc.
2. 事件探测：ASM、Annotation、ImeException
3. 持久化与上传：大数据量压缩、存储、上传
4. 	防混淆处理

#### 2.2.2. 链路分析：通过埋点情况分析错误节点

1. 建立功能埋点标准路径
2. 分析上传的路径与标准路径之间的差异，分析问题节点
	
### 2.3. 严重错误自恢复

#### 2.3.1. 错误感知：

1. 识别频繁的重复崩溃：数据错误引起or代码逻辑引起
2. 识别因重要文件丢失导致的问题
3. 根据统一的ImeException进行判断

#### 2.3.2. 自动恢复

1. 主动触发热修复方案
2. 回退数据状态
3. 下载新安装包

### 2.4. 卡顿监控完善

增加短阈值卡顿监控能力：帧级别卡顿监控，解决输入法过程中出现的卡顿问题

### 2.5. 建立线上ANR监控

基于`FileObserver`与`/data/anr/traces.txt`监控ANR情况。

## 3. 性能优化

###### 只计划通用优化部分

1. MMKV引入解决SharedPreference性能问题
2. MMAP引入解决大量文件I/O问题
3. etc.